"use strict";(()=>{(function(){if(window.__PROXY_HIGHLIGHT_INIT__)return;window.__PROXY_HIGHLIGHT_INIT__=!0;let i={...{borderColor:"#FF4444",borderWidth:3,overlayColor:"rgba(255, 68, 68, 0.12)",scrollBehavior:"smooth",scrollBlock:"center",labelBackground:"#FF4444",labelColor:"#FFFFFF"}},u=null,h=null,g=null,f=null,m=null,p=null,y=null,b=null,d=null,a=null,w=!1,v=null;function D(){if(u)return;let e=t=>{let o=document.createElement("div");return o.setAttribute("data-proxy-highlight","true"),o.style.cssText=`
        position: fixed;
        pointer-events: none;
        z-index: ${t};
        transition: all 0.15s ease-out;
      `,document.documentElement.appendChild(o),o};u=e(2147483640),h=e(2147483640),g=e(2147483640),f=e(2147483640),[u,h,g,f].forEach(t=>{t.style.backgroundColor=i.overlayColor}),m=e(2147483641),p=e(2147483641),y=e(2147483641),b=e(2147483641),[m,p,y,b].forEach(t=>{t.style.backgroundColor=i.borderColor}),d=e(2147483642),d.style.cssText+=`
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, monospace;
      font-size: 11px;
      font-weight: 600;
      padding: 2px 6px;
      border-radius: 2px;
      white-space: nowrap;
      color: ${i.labelColor};
      background: ${i.labelBackground};
      line-height: 1.4;
    `}function L(e){if(!u)return;let t=i.borderWidth,o=window.innerWidth,n=window.innerHeight,l=Math.max(0,e.top),r=Math.max(0,e.left),s=Math.min(n,e.bottom),C=Math.min(o,e.right),H=C-r,k=s-l;if(u.style.top="0",u.style.left="0",u.style.width=o+"px",u.style.height=l+"px",h.style.top=s+"px",h.style.left="0",h.style.width=o+"px",h.style.height=n-s+"px",g.style.top=l+"px",g.style.left="0",g.style.width=r+"px",g.style.height=k+"px",f.style.top=l+"px",f.style.left=C+"px",f.style.width=o-C+"px",f.style.height=k+"px",m.style.top=l-t+"px",m.style.left=r-t+"px",m.style.width=H+t*2+"px",m.style.height=t+"px",p.style.top=s+"px",p.style.left=r-t+"px",p.style.width=H+t*2+"px",p.style.height=t+"px",y.style.top=l+"px",y.style.left=r-t+"px",y.style.width=t+"px",y.style.height=k+"px",b.style.top=l+"px",b.style.left=C+"px",b.style.width=t+"px",b.style.height=k+"px",d&&a){let O=a.tagName.toLowerCase(),P=a.id?`#${a.id}`:"",W=Array.from(a.classList).slice(0,3).map(U=>`.${U}`).join(""),X=`${Math.round(e.width)}\xD7${Math.round(e.height)}`;d.textContent=`${O}${P}${W} (${X})`;let R=20;l>R+4?d.style.top=l-R-4+"px":d.style.top=s+4+"px",d.style.left=Math.max(0,r)+"px"}}function $(){[u,h,g,f,m,p,y,b,d].forEach(t=>{t&&(t.style.display="block")})}function B(){[u,h,g,f,m,p,y,b,d].forEach(t=>{t&&(t.style.display="none")})}function x(e,t){if(D(),!e){B(),a=null,_();return}t!=null&&t.color&&(i.borderColor=t.color,i.overlayColor=F(t.color,.12),i.labelBackground=t.color,[m,p,y,b].forEach(n=>{n&&(n.style.backgroundColor=i.borderColor)}),[u,h,g,f].forEach(n=>{n&&(n.style.backgroundColor=i.overlayColor)}),d&&(d.style.background=i.labelBackground)),a=e;let o=e.getBoundingClientRect();L(o),$(),A(),(t==null?void 0:t.scroll)!==!1&&(e.scrollIntoView({behavior:i.scrollBehavior,block:i.scrollBlock}),setTimeout(()=>{a===e&&L(e.getBoundingClientRect())},500)),c("element-highlighted",{selector:T(e),tagName:e.tagName.toLowerCase(),id:e.id||null,classes:Array.from(e.classList),rect:{top:o.top,left:o.left,width:o.width,height:o.height},text:(e.textContent||"").trim().substring(0,200)})}function A(){_();let e=()=>{a&&L(a.getBoundingClientRect()),v=requestAnimationFrame(e)};v=requestAnimationFrame(e)}function _(){v!==null&&(cancelAnimationFrame(v),v=null)}function N(){w||(w=!0,document.addEventListener("mousemove",S,!0),document.addEventListener("click",M,!0),document.body.style.cursor="crosshair",c("inspector-mode",{enabled:!0}))}function E(){w&&(w=!1,document.removeEventListener("mousemove",S,!0),document.removeEventListener("click",M,!0),document.body.style.cursor="",c("inspector-mode",{enabled:!1}))}function S(e){let t=document.elementFromPoint(e.clientX,e.clientY);t&&!t.hasAttribute("data-proxy-highlight")&&t!==document.documentElement&&t!==document.body&&x(t,{scroll:!1})}function M(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let t=document.elementFromPoint(e.clientX,e.clientY);t&&!t.hasAttribute("data-proxy-highlight")&&(x(t,{scroll:!1}),E())}function T(e){if(e.id)return`#${CSS.escape(e.id)}`;let t=[],o=e;for(;o&&o!==document.documentElement;){let n=o.tagName.toLowerCase();if(o.id){n=`#${CSS.escape(o.id)}`,t.unshift(n);break}let l=o.parentElement;if(l){let r=Array.from(l.children).filter(s=>s.tagName===o.tagName);if(r.length>1){let s=r.indexOf(o)+1;n+=`:nth-of-type(${s})`}}t.unshift(n),o=l}return t.join(" > ")}function F(e,t){let o=parseInt(e.slice(1,3),16),n=parseInt(e.slice(3,5),16),l=parseInt(e.slice(5,7),16);return`rgba(${o}, ${n}, ${l}, ${t})`}function c(e,t){try{window.parent.postMessage({source:"proxy-highlight",type:e,data:t},"*")}catch(o){}}window.addEventListener("message",e=>{let t=e.data;if(!(!t||t.source!=="proxy-highlight-host"))switch(t.type){case"highlight-selector":{let o=document.querySelector(t.selector);o?x(o,{scroll:t.scroll!==!1,color:t.color}):c("error",{message:`Element not found: ${t.selector}`});break}case"highlight-xpath":{let n=document.evaluate(t.xpath,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;n?x(n,{scroll:t.scroll!==!1,color:t.color}):c("error",{message:`Element not found: ${t.xpath}`});break}case"highlight-text":{let o=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,null),n=!1;for(;o.nextNode();){let l=o.currentNode;if(l.textContent&&l.textContent.includes(t.text)&&l.parentElement){x(l.parentElement,{scroll:t.scroll!==!1,color:t.color}),n=!0;break}}n||c("error",{message:`No element containing text: ${t.text}`});break}case"enable-inspector":N();break;case"disable-inspector":E();break;case"clear-highlight":x(null),E();break;case"update-config":i={...i,...t.config},a&&x(a,{scroll:!1});break;case"get-dom-tree":{let o=I(document.body,t.maxDepth||4);c("dom-tree",{tree:o});break}case"get-element-info":{let o=document.querySelector(t.selector);if(o){let n=o.getBoundingClientRect(),l=window.getComputedStyle(o);c("element-info",{selector:t.selector,tagName:o.tagName.toLowerCase(),id:o.id,classes:Array.from(o.classList),attributes:Array.from(o.attributes).map(r=>({name:r.name,value:r.value})),rect:{top:n.top,left:n.left,width:n.width,height:n.height},computedStyle:{display:l.display,position:l.position,fontSize:l.fontSize,color:l.color,backgroundColor:l.backgroundColor},text:(o.textContent||"").trim().substring(0,500),html:o.outerHTML.substring(0,1e3),childCount:o.children.length})}break}}});function I(e,t,o=0){if(o>t||e.hasAttribute("data-proxy-highlight")||e.hasAttribute("data-proxy-injected"))return null;let n={tag:e.tagName.toLowerCase(),selector:T(e)};e.id&&(n.id=e.id),e.classList.length>0&&(n.classes=Array.from(e.classList));let l=Array.from(e.childNodes).find(r=>{var s;return r.nodeType===Node.TEXT_NODE&&((s=r.textContent)==null?void 0:s.trim())});return l&&(n.text=(l.textContent||"").trim().substring(0,100)),e.children.length>0&&o<t&&(n.children=Array.from(e.children).map(r=>I(r,t,o+1)).filter(Boolean)),n}document.addEventListener("keydown",e=>{e.key==="Escape"&&(w&&E(),x(null)),(e.ctrlKey||e.metaKey)&&e.shiftKey&&e.key==="C"&&(e.preventDefault(),w?E():N())}),document.addEventListener("click",e=>{if(w)return;let t=e.target;for(;t&&t.tagName!=="A";)t=t.parentElement;if(!t)return;let o=t,n=o.getAttribute("href");if(!n||n.startsWith("#")||n.startsWith("javascript:")||n.startsWith("mailto:")||n.startsWith("tel:"))return;let l;try{let r=new URL(n,window.location.href);if(r.pathname===window.location.pathname&&r.search===window.location.search&&r.hash!==window.location.hash)return;let s=window.__PROXY_ORIGIN__||"";l=s?s+r.pathname+r.search+r.hash:r.href}catch(r){l=n}e.preventDefault(),e.stopPropagation(),c("link-navigation",{url:l,text:(o.textContent||"").trim().substring(0,200),selector:T(o)})},!0);let G=history.pushState,q=history.replaceState;history.pushState=function(e,t,o){if(o){let n=window.__PROXY_ORIGIN__||"",l;try{let r=new URL(String(o),window.location.href);l=n?n+r.pathname+r.search+r.hash:r.href}catch(r){l=String(o)}c("link-navigation",{url:l,text:"",selector:"",type:"pushState"})}},history.replaceState=function(e,t,o){if(o&&String(o)!==window.location.href){let n=window.__PROXY_ORIGIN__||"",l;try{let r=new URL(String(o),window.location.href);l=n?n+r.pathname+r.search+r.hash:r.href}catch(r){l=String(o)}c("link-navigation",{url:l,text:"",selector:"",type:"replaceState"})}},c("ready",{url:window.location.href})})();})();
